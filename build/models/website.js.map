{"version":3,"sources":["../../src/models/website.js"],"names":["Joi","objectId","websiteSchema","mongoose","Schema","title","type","String","required","trim","minlength","maxlength","header","footer","domain","lowercase","unique","sparse","bufferElements","pagesStructure","currentPage","Types","ObjectId","ref","blankPageContent","sectionsOnPage","currentId","element_0","height","space","background","allPages","children","styles","element_1","width","left","top","zIndex","parent","element_6","itemsList","id","key","name","newTab","hidden","path","element_2","element_3","element_1_element_0_hover","influencer","element_4","backgroundOn","element_5","textContent","object","document","data","nodes","leaves","text","marks","methods","createPage","duplicate","generateNewPageName","attr","divider","i","some","item","prepareDataCreteNewPage","page","Page","website","publishedVersion","content","markModified","save","pageData","max","nameIndex","urlIndex","Math","nameAdd","urlAdd","url","isHidden","description","prepareDataDuplicate","findById","currentPageObject","currentPageDataArray","filter","toString","length","currentPageData","isHomePage","push","_id","currentPageObjectArray","currentIndex","indexOf","descendants","newPageStructureElement","splice","deletePage","pageId","descedants","map","Promise","all","findByIdAndRemove","Website","model","validateWebsite","schema","string","min","array","validate"],"mappings":"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","sourcesContent":["import Joi from 'joi'\nimport mongoose from 'mongoose'\nimport { Page } from './page'\nimport { findDescendants } from '../utils/pagesStructure'\nimport JoiObjectId from 'joi-objectid'\nJoi.objectId = JoiObjectId(Joi)\n\nconst websiteSchema = new mongoose.Schema({\n    title: {\n        type: String,\n        required: true,\n        trim: true,\n        minlength: 1,\n        maxlength: 255,\n    },\n    header: {},\n    footer: {},\n    domain: {\n        type: String,\n        minlength: 1,\n        maxlength: 255,\n        lowercase: true,\n        trim: true,\n        unique: true,\n        sparse: true,\n    },\n    bufferElements: {\n        type: String,\n        minlength: 1,\n    },\n    pagesStructure: [],\n    currentPage: {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'Pages',\n    },\n})\n\nconst blankPageContent = {\n    sectionsOnPage: ['element_0', 'element_4'],\n    currentId: 6,\n    element_0: {\n        type: 'section',\n        height: 200,\n        space: 50,\n        background: 'rgba(200, 100, 30)',\n        header: false,\n        footer: false,\n        allPages: false,\n        children: ['element_3', 'element_1', 'element_6'],\n        styles: [],\n    },\n    element_1: {\n        type: 'box',\n        height: 100,\n        width: 100,\n        left: 200,\n        top: 100,\n        background: 'rgba(100, 0, 80)',\n        zIndex: 0,\n        children: ['element_2'],\n        parent: 'element_0',\n        styles: ['element_1_element_0_hover'],\n    },\n    element_6: {\n        type: 'menu',\n        height: 50,\n        width: 300,\n        left: 500,\n        top: 100,\n        background: 'rgba(100, 0, 80)',\n        zIndex: 0,\n        children: [],\n        parent: 'element_0',\n        styles: [],\n        itemsList: [\n            {\n                id: '0',\n                key: '0',\n                name: 'Home',\n                type: 'page',\n                newTab: false,\n                hidden: false,\n                path: [],\n            },\n        ],\n    },\n    element_2: {\n        type: 'box',\n        height: 50,\n        width: 50,\n        left: 100,\n        top: 200,\n        background: 'rgba(10, 200, 90)',\n        zIndex: 0,\n        children: [],\n        parent: 'element_1',\n        styles: [],\n    },\n    element_3: {\n        type: 'box',\n        height: 50,\n        width: 50,\n        left: 200,\n        top: 200,\n        background: 'rgba(170, 100, 200)',\n        zIndex: 1,\n        children: [],\n        parent: 'element_0',\n        styles: [],\n    },\n    element_1_element_0_hover: {\n        type: 'hover',\n        influencer: 'element_0',\n        left: 0,\n        top: 0,\n    },\n    element_4: {\n        type: 'section',\n        height: 500,\n        space: 50,\n        background: 'rgba(200, 100, 30)',\n        backgroundOn: true,\n        header: false,\n        footer: false,\n        allPages: false,\n        children: ['element_5'],\n        styles: [],\n    },\n    element_5: {\n        type: 'text',\n        height: 400,\n        width: 400,\n        left: 500,\n        top: 40,\n        background: 'rgba(170, 100, 200)',\n        backgroundOn: true,\n        zIndex: 1,\n        children: [],\n        parent: 'element_4',\n        styles: [],\n        textContent: {\n            object: 'value',\n            document: {\n                object: 'document',\n                data: {},\n                nodes: [\n                    {\n                        object: 'block',\n                        type: 'paragraph',\n                        data: {},\n                        nodes: [\n                            {\n                                object: 'text',\n                                leaves: [\n                                    {\n                                        object: 'leaf',\n                                        text:\n                                            'A line of tsdfdsfsdfdsds;lkfsd;kfsd;lfk.',\n                                        marks: [],\n                                    },\n                                ],\n                            },\n                        ],\n                    },\n                ],\n            },\n        },\n    },\n}\n\nwebsiteSchema.methods.createPage = async function(currentPage, duplicate) {\n    const generateNewPageName = (name, attr, divider, i): number => {\n        while (this.pagesStructure.some(item => item[attr] === name)) {\n            i++\n            name = name + divider + i\n        }\n        return i\n    }\n\n    const prepareDataCreteNewPage = async () => {\n        let page = new Page()\n        page.website = this\n        page.publishedVersion = {}\n        page.content = blankPageContent\n        page.markModified('content')\n        page.markModified('publishedVersion')\n        page = await page.save()\n\n        this.currentPage = page\n        const pageData = {}\n\n        let max = 0,\n            nameIndex = 0,\n            urlIndex = 0\n        do {\n            nameIndex = generateNewPageName('New page', 'name', ' ', max)\n            urlIndex = generateNewPageName('new-page', 'url', '-', max)\n            max = Math.max(nameIndex, urlIndex)\n        } while (nameIndex !== urlIndex)\n\n        let nameAdd = ''\n        let urlAdd = ''\n        if (max > 0) {\n            nameAdd = ' ' + max\n            urlAdd = '-' + max\n        }\n\n        pageData.name = 'New page' + nameAdd\n        pageData.url = 'new-page' + urlAdd\n        pageData.isHidden = false\n        pageData.title = 'New page on my website'\n        pageData.description = 'This my new page description'\n\n        return { page, pageData }\n    }\n    const prepareDataDuplicate = async () => {\n        const currentPageObject = await Page.findById(currentPage)\n        const currentPageDataArray = this.pagesStructure.filter(\n            item => item.id.toString() === currentPage\n        )\n        if (!currentPageObject || currentPageDataArray.length !== 1) {\n            return { page: null, pageData: null }\n        }\n        let currentPageData: {\n            name: string,\n            url: string,\n            isHidden: boolean,\n            title: string,\n            description: string,\n        }\n        currentPageData = currentPageDataArray[0]\n\n        let page = new Page()\n        page.website = this\n        page.publishedVersion = currentPageObject.publishedVersion\n        page.content = currentPageObject.content\n        page.markModified('content')\n        page.markModified('publishedVersion')\n        page = await page.save()\n\n        this.currentPage = page\n        const pageData = {}\n\n        let max = 0,\n            nameIndex = 0,\n            urlIndex = 0\n        do {\n            nameIndex = generateNewPageName(\n                currentPageData.name,\n                'name',\n                ' ',\n                max\n            )\n            urlIndex = generateNewPageName(currentPageData.url, 'url', '-', max)\n            max = Math.max(nameIndex, urlIndex)\n        } while (nameIndex !== urlIndex)\n\n        pageData.name = currentPageData.name + ' ' + max\n        pageData.url = currentPageData.url + '-' + max\n        pageData.isHidden = currentPageData.isHidden\n        pageData.title = currentPageData.title\n        pageData.description = currentPageData.description\n\n        return { page, pageData }\n    }\n\n    const { page, pageData } = duplicate\n        ? await prepareDataDuplicate()\n        : await prepareDataCreteNewPage()\n\n    if (!page || !pageData) return\n\n    if (this.pagesStructure.length > 0) {\n        pageData.isHomePage = false\n    } else {\n        pageData.isHomePage = true\n    }\n\n    let newPageStructureElement\n    if (!currentPage) {\n        this.pagesStructure.push({\n            id: page._id,\n            path: [],\n            ...pageData,\n        })\n    } else {\n        const currentPageObjectArray = this.pagesStructure.filter(\n            page => page.id.toString() === currentPage.toString()\n        )\n        if (currentPageObjectArray.length > 0) {\n            const currentPageObject = currentPageObjectArray[0]\n            const currentIndex = this.pagesStructure.indexOf(currentPageObject)\n\n            const descendants = findDescendants(\n                this.pagesStructure,\n                currentPageObject.id\n            )\n            newPageStructureElement = {\n                id: page._id,\n                path: [...currentPageObject.path],\n                ...pageData,\n            }\n            this.pagesStructure.splice(\n                currentIndex + descendants.length + 1,\n                0,\n                newPageStructureElement\n            )\n        } else {\n            this.pagesStructure.push({\n                id: page._id,\n                path: [],\n                ...pageData,\n            })\n        }\n    }\n    this.markModified('pagesStructure')\n    return {\n        page,\n        pagesStructure: this.pagesStructure,\n    }\n}\n\nwebsiteSchema.methods.deletePage = async function(pageId) {\n    const descedants = findDescendants(this.pagesStructure, pageId).map(\n        item => item.id\n    )\n    descedants.push(pageId)\n\n    await Promise.all(\n        descedants.map(async id => {\n            this.pagesStructure = this.pagesStructure.filter(\n                item => item.id.toString() != id.toString()\n            )\n            await Page.findByIdAndRemove(id)\n        })\n    )\n\n    if (!this.pagesStructure.some(item => item.isHomePage)) {\n        if (this.pagesStructure.length > 0) {\n            this.pagesStructure[0].isHomePage = true\n        }\n    }\n\n    if (\n        descedants.some(page => page.toString() === this.currentPage.toString())\n    ) {\n        if (this.pagesStructure.length > 0) {\n            this.currentPage = this.pagesStructure[0].id\n        } else {\n            this.currentPage = null\n        }\n    }\n\n    this.markModified('pagesStructure')\n}\n\nexport const Website = mongoose.model('Website', websiteSchema)\n\nexport const validateWebsite = (website: {}) => {\n    const schema = {\n        title: Joi.string()\n            .min(1)\n            .max(50),\n        header: Joi.string().min(1),\n        footer: Joi.string().min(1),\n        domain: Joi.string()\n            .min(1)\n            .max(255),\n        bufferElements: Joi.string(),\n        pagesStructure: Joi.array(),\n        currentPage: Joi.objectId(),\n    }\n\n    return Joi.validate(website, schema)\n}\n"],"file":"website.js"}